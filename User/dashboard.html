<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReFoundly | Lost & Found</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* 1. ULTIMATE UNDERLINE REMOVER */
        .btn-main, 
        .hero-actions a, 
        .card-body .btn-main,
        .footer-links a {
            text-decoration: none !important;
            display: inline-block;
            border: none;
        }

        /* Ensure the button looks like a button even if it's a link */
        .btn-main:hover {
            text-decoration: none !important;
            opacity: 0.9;
        }
    </style>
</head>
<body>

<nav class="navbar">
    <h1>ReFoundly</h1>
    <div class="nav-icons">
        <a href="message.html" class="icons-link active-link"><i class="fas fa-comment-dots"></i></a>
        <i class="fas fa-bell"></i>
        <div class="burger-container">
            <input type="checkbox" id="menu-toggle">
            <label for="menu-toggle" class="hamburger"><i class="fas fa-bars"></i></label>
            <div class="nav-menu">
                <a href="user_acc.html"><i class="fas fa-user-circle"></i> Account</a>
                <a href="history.html"><i class="fas fa-history"></i> History</a>
                <a href="index.html" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
    </div>
</nav>

<div class="main-wrapper">
    <header class="hero">
        <h2>Lost Something? Found Something?</h2>
        <p>Browse lost items or report one to help reconnect owners with their belongings.</p>
        <div class="hero-actions">
            <a href="found.html" class="btn-main">Browse Found Items</a>
            <a href="lost.html" class="btn-main">Browse Lost Items</a>
            <a href="report.html" class="btn-main">Report Found/Lost Items</a>
        </div>
    </header>

    <section class="search-container">
        <div class="search-group">
            <label><strong>Search for an Item</strong></label>
            <div class="custom-dropdown">
                <input type="text" placeholder="Select category" id="categoryInput">
                <ul class="dropdown-menu" id="categoryList">
                    <li>Wallet</li><li>Cellphone</li><li>Laptop</li><li>Gadgets</li>
                    <li>Accessories</li><li>Clothing</li><li>ID</li><li>Documents</li>
                    <li>Books</li><li>School Supplies</li><li>Tools</li><li>Others</li>
                </ul>
            </div>
        </div>
        <div class="search-group">
            <label><strong>Location</strong></label>
            <div class="custom-dropdown">
                <input type="text" placeholder="Enter or search location..." id="locationInput" autocomplete="off">
                <ul class="dropdown-menu" id="locationList">
                    <li>Bonuan Gueset</li><li>Lucao</li><li>Malued</li><li>Pantal</li><li>Tapuac</li>
                </ul>
            </div>
        </div>
        <div class="search-group">
            <input type="text" placeholder="Search item name...">
        </div>
        <button class="btn-main" style="padding: 12px 40px;">Search</button>
    </section>

    <div class="content-wrapper">
        <h3>Recent Lost and Found Items</h3>
        <div class="grid"></div>

        <div class="pagination-container">
            <button class="btn-pagination" id="prevBtn">Previous</button>
            <span class="page-info" id="pageInfo">Page 1 of 1</span>
            <button class="btn-pagination" id="nextBtn">Next</button>
        </div>

        <section class="how-it-works">
            <div class="step-card">
                <p>Step 1</p>
                <div class="step-line"></div>
                <strong>Browse or Search Lost Items</strong>
            </div>
            <div class="step-card">
                <p>Step 2</p>
                <div class="step-line"></div>
                <strong>Login to Post a Lost Item</strong>
            </div>
            <div class="step-card">
                <p>Step 3</p>
                <div class="step-line" style="background:#78A454;"></div>
                <strong>Reconnect Items with Owners</strong>
            </div>
        </section>
    </div>
</div>

<footer>
        <div class="footer-links">
            <div class="popup-item">
                <a href="#">About</a>
                <span class="popup-box">
                    <strong>About ReFoundly</strong><br>
                    ReFoundly is a premier digital portal dedicated to bridging the gap between lost possessions and their rightful owners...
                </span>
            </div>
            | 
            <div class="popup-item">
                <a href="#">Contact</a>
                <span class="popup-box">
                    <strong>Contact Us</strong><br>
                    Email: refoundly@gmail.com<br>
                    Phone: +63 912 345 6789
                </span>
            </div>
            | 
            <div class="popup-item">
                <a href="#">Privacy Policy</a>
                <span class="popup-box">
                    <strong>Privacy Policy</strong><br>
                    We take your security seriously...
                </span>
            </div>
            | 
            <div class="popup-item">
                <a href="#">Terms</a>
                <span class="popup-box">
                    <strong>Terms of Use</strong><br>
                    By using this portal, you agree to provide only truthful information...
                </span>
            </div>
        </div>
        <div class="socials">
            <i class="fab fa-facebook"></i> &nbsp; <i class="fab fa-instagram"></i> &nbsp; <i class="fab fa-linkedin"></i>
        </div>
        <p>Â© 2026 Digital Lost & Found Portal</p>
    </footer>

<script>
   let allItems = []; 
let filteredItems = []; 
let currentPage = 1;
const itemsPerPage = 3; 

// 1. Setup Dropdown Search Logic
function setupSearch(inputId, listId) {
    const input = document.getElementById(inputId);
    const list = document.getElementById(listId);
    if (!input || !list) return;

    const items = list.querySelectorAll('li');

    input.addEventListener('keyup', function() {
        let filter = this.value.toLowerCase();
        list.style.display = 'block'; 
        items.forEach(item => {
            let text = item.textContent.toLowerCase();
            item.style.display = text.includes(filter) ? "block" : "none";
        });
    });

    items.forEach(item => {
        item.addEventListener('click', function() {
            input.value = this.textContent;
            list.style.display = 'none'; 
        });
    });

    document.addEventListener('click', (e) => {
        if (!input.contains(e.target) && !list.contains(e.target)) list.style.display = 'none';
    });
    
    input.addEventListener('focus', () => list.style.display = 'block');
}

// 2. Load Data from API
async function loadPublishedItems() {
    try {
        const response = await fetch('/api/items/published');
        allItems = await response.json(); 
        filteredItems = [...allItems]; // Sync filtered list with master list
        renderPage(1); 
    } catch (error) {
        console.error("Error loading items:", error);
        const grid = document.querySelector(".grid");
        if(grid) grid.innerHTML = "<p>Error connecting to the server.</p>";
    }
}

// 3. Filter Logic (The Fix)
function applyFilters() {
    const category = document.getElementById('categoryInput').value.toLowerCase().trim();
    const location = document.getElementById('locationInput').value.toLowerCase().trim();
    // Targets the generic search input
    const nameSearch = document.querySelector('.search-group input[placeholder="Search item name..."]').value.toLowerCase().trim();

    filteredItems = allItems.filter(item => {
        const matchCategory = !category || item.category.toLowerCase().includes(category);
        const matchLocation = !location || item.location.toLowerCase().includes(location);
        const matchName = !nameSearch || item.item_name.toLowerCase().includes(nameSearch);
        return matchCategory && matchLocation && matchName;
    });

    currentPage = 1; // Reset to page 1 on new search
    renderPage(1);
}

// 4. Render Grid
function renderPage(page) {
    const grid = document.querySelector(".grid");
    if(!grid) return;
    grid.innerHTML = ""; 

    if (filteredItems.length === 0) {
        grid.innerHTML = "<div style='grid-column: 1/-1; text-align:center; padding: 20px;'><h3>No items found.</h3></div>";
        updatePaginationUI();
        return;
    }

    const startIndex = (page - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const paginatedItems = filteredItems.slice(startIndex, endIndex);

    paginatedItems.forEach(item => {
        const card = document.createElement("div");
        card.className = "card";
        card.setAttribute('data-id', item.id);
        
        const imageHtml = item.image_path 
            ? `<img src="${item.image_path}" alt="${item.item_name}" style="width:100%; height:200px; object-fit:cover;">`
            : `<div class="card-img" style="height:200px; display:flex; align-items:center; justify-content:center; background:#eee;">No Image</div>`;

        const dbType = (item.report_type || item.type || "").toLowerCase().trim();

        card.innerHTML = `
            ${imageHtml}
            <div class="card-body">
                <h4>${item.item_name}</h4>
                <span class="badge" style="background:#78A454; color:white; padding:2px 8px; border-radius:4px;">${item.category}</span>
                <p style="font-size: 12px; color: #999; margin-top:10px;">Posted: ${item.formattedDate || 'Recent'}</p>
                <button class="btn-main" onclick="finalRedirect(${item.id}, '${dbType}')" style="width:100%; margin-top:15px; cursor: pointer;">View Details</button>
            </div>
        `;
        grid.appendChild(card);
    });

    updatePaginationUI();
}

// 5. Navigation & UI Helpers
function finalRedirect(id, type) {
    const verifiedType = String(type || "").toLowerCase().trim();
    if (verifiedType === "lost") {
        window.location.href = "lost.html?open=" + id;
    } else {
        window.location.href = "found.html?open=" + id;
    }
}

function updatePaginationUI() {
    const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
    const pageInfo = document.getElementById("pageInfo");
    if(pageInfo) pageInfo.textContent = `Page ${currentPage} of ${totalPages || 1}`;
    
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    
    if(prevBtn) {
        prevBtn.disabled = (currentPage === 1);
        prevBtn.style.opacity = (currentPage === 1) ? "0.5" : "1";
    }
    if(nextBtn) {
        nextBtn.disabled = (currentPage >= totalPages || totalPages === 0);
        nextBtn.style.opacity = (nextBtn.disabled) ? "0.5" : "1";
    }
}

// 6. Initialize
document.addEventListener("DOMContentLoaded", () => {
    setupSearch('categoryInput', 'categoryList');
    setupSearch('locationInput', 'locationList');
    loadPublishedItems();

    // Link Search Button
    const searchBtn = document.querySelector('.search-container .btn-main');
    if(searchBtn) searchBtn.addEventListener('click', applyFilters);

    // Pagination Listeners
    document.getElementById("prevBtn")?.addEventListener("click", () => {
        if (currentPage > 1) {
            currentPage--;
            renderPage(currentPage);
            window.scrollTo({ top: 400, behavior: 'smooth' });
        }
    });

    document.getElementById("nextBtn")?.addEventListener("click", () => {
        const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            renderPage(currentPage);
            window.scrollTo({ top: 400, behavior: 'smooth' });
        }
    });
});
</script>
</body>
</html>