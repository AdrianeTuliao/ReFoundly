<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReFoundly | History</title>
    <link rel="stylesheet" href="history.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <header class="navbar">
        <h1>ReFoundly</h1>
        <div class="nav-icons">
            <a href="history.html" class="history-link">
                <i class="fas fa-history"></i>
            </a>
            <a href="message.html" class="history-link active-link">
                <i class="fas fa-comment-dots"></i>
            </a>
            <i class="fas fa-bell"></i>
            <i class="fas fa-user-circle"></i>
        </div>
    </header>

    <main class="container">
        <nav class="breadcrumb">
            <a href="dashboard.html">Home</a> &gt; <span>History</span>
        </nav>

        <section class="search-section">
            <div class="search-bar-pill">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search in History">
            </div>
        </section>

        <div class="items-grid">
            <p style="grid-column: 1/-1; text-align: center; opacity: 0.5;">Loading your history...</p>
        </div>

        <div class="pagination">
            <button class="pag-btn">&lt;</button>
            <button class="pag-btn active">1</button>
            <button class="pag-btn">2</button>
            <button class="pag-btn">3</button>
            <span>..</span>
            <button class="pag-btn">10</button>
            <button class="pag-btn">&gt;</button>
        </div>
    </main>

    <footer>
        <div class="footer-links">
            <a href="#">About</a> | <a href="#">Contact</a> | <a href="#">Privacy Policy</a> | <a href="#">Terms</a>
        </div>
        <div class="socials">
            <i class="fab fa-facebook"></i>
            <i class="fab fa-instagram"></i>
            <i class="fab fa-linkedin"></i>
        </div>
        <p>Â© 2026 Digital Lost & Found Portal</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const grid = document.querySelector(".items-grid");
            const wrapper = document.querySelector(".main-wrapper");

            // 1. Initial Page Transitions
            if (wrapper) {
                setTimeout(() => wrapper.classList.add("fade-in"), 100);
            }

            // 2. FETCH REAL DATA FROM SERVER
            fetch('/api/user-history')
                .then(response => response.json())
                .then(data => {
                    grid.innerHTML = ""; // Clear the "Loading..." text
                    
                    if (data.length === 0) {
                        grid.innerHTML = "<p style='grid-column: 1/-1; text-align: center;'>You haven't submitted any reports yet.</p>";
                        return;
                    }

                    data.forEach(item => {
                        const card = document.createElement("div");
                        card.className = "item-card";
                        
                        const statusClass = item.report_type.toLowerCase() === 'found' ? 'status-found' : 'status-lost';
                        
                        card.innerHTML = `
                            <div class="card-img-placeholder" style="background-image: url('${item.image_path}'); background-size: cover; background-position: center;">
                                ${item.image_path ? '' : 'No Image'}
                            </div>
                            <div class="card-content">
                                <h3>${item.item_name}</h3>
                                <hr class="title-line">
                                <span class="badge">${item.category}</span>
                                <div class="item-details">
                                    <p><strong>Description:</strong> ${item.description || 'No description'}</p>
                                    <p><strong>Where ${item.report_type}:</strong> ${item.location}</p>
                                    <p><strong>Status:</strong> <span class="${statusClass}">${item.status}</span></p>
                                    <p><strong>Owner:</strong> ${item.contact_firstname} ${item.contact_lastname}</p>
                                    <p><strong>Phone:</strong> ${item.contact_phone}</p>
                                    <p><strong>Email:</strong> ${item.contact_email}</p>
                                    <div class="post-time">
                                        <small>Date: ${item.formattedDate}</small><br>
                                        <small>Time: ${item.formattedTime}</small>
                                    </div>
                                </div>
                                <input type="text" class="comment-input" placeholder="Comment (Coming Soon)">
                            </div>
                        `;
                        grid.appendChild(card);
                    });

                    // 3. Trigger "Rise Up" effect ONLY after data is loaded
                    setTimeout(() => {
                        grid.classList.add("rise-up");
                    }, 100);
                })
                .catch(err => {
                    console.error("Error loading history:", err);
                    grid.innerHTML = "<p style='grid-column: 1/-1; text-align: center; color: red;'>Error loading history. Please try again later.</p>";
                });

            // 4. Navigation Exit Animations
            const navLinks = document.querySelectorAll('.nav-icons a, .hero-actions a, .icon-link');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    const targetHref = link.getAttribute('href');
                    if (link.hostname === window.location.hostname && targetHref !== "#") {
                        e.preventDefault();
                        if (grid) grid.classList.remove("rise-up");
                        if (wrapper) wrapper.classList.remove("fade-in");
                        
                        setTimeout(() => {
                            window.location.href = link.href;
                        }, 500);
                    }
                });
            });
        });
    </script>
</body>
</html>